select(matches("[a-z][0-9]{2}$|gdpsh5|gdpsh4|pop15|pop65|lifee0|pysh5|pcsh5|pish5|pgsh5"),
-c(matches("grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5|smpl97")
))
153+373+65
dfy <- df %>%
select(matches("[a-z][0-9]{1}$|grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5"),
-durs1)
names(df)[which(!names(df) %in% c(names(dfy), names(dfyy)))]
153+373+29
dfyl <- df %>% select(matches("bmp"))
dfyl
dfyl %>% names
dfyl <- df %>%
select(matches("bmp[0-9]l|bmp2ml"))
dfyl %>% names
names(df)[which(!names(df) %in% c(names(dfy), names(dfyy), names(dfyl)))]
dfconst <- df %>%
select(names(df)[which(!names(df) %in% c(names(dfy), names(dfyy), names(dfyl)))])
23+153+6+373
cut_colname_file <- data.frame(Colname = colnames(dfyy)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-2)) %>%
unique()
cut_colname_file
df_list <- list()
df_list <- list()
df_list$dfy <- df %>%
select(matches("[a-z][0-9]{1}$|grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5"),
-durs1)
df_list$dfyy <- df %>%
select(matches("[a-z][0-9]{2}$|gdpsh5|gdpsh4|pop15|pop65|lifee0|pysh5|pcsh5|pish5|pgsh5"),
-c(matches("grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5|smpl97")
))
df_list$dfyl <- df %>%
select(matches("bmp[0-9]l|bmp2ml"))
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = if_else(i == 2, "xx",
if_else(i == 1, "x", "con"))) %>%
unique() %>%
return()
}
imap(df_list, cut.colname.BL)
df_list[[1]]
df_list[[1]] %>% colnames()
df_list[[2]] %>% colnames()
file_colname
data.frame(Colname = colnames(df_list[[1]])) %>%
inner_join(file_colname, by = "Colname")
data.frame(Colname = colnames(df_list[[1]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-1))
i=1
data.frame(Colname = colnames(df_list[[i]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con")))
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %T>%
print() %>%
return()
}
imap(df_list, cut.colname.BL)
df_list
cut.colname.BL <- function(df, i) {
print(df)
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %T>%
print() %>%
return()
}
imap(df_list, cut.colname.BL)
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %T>%
print() %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %T>%
print() %>%
return()
}
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
imap(df_list, cut.colname.BL)
i=1
data.frame(Colname = colnames(df[[i]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i))
i=1
data.frame(Colname = colnames(df[[i]]))
df[[1]]
i=1
data.frame(Colname = colnames(df_list[[i]])) %>%
inner_join(file_colname, by = "Colname")
i=1
data.frame(Colname = colnames(df_list[[i]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i))
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df_list[[i]])) %>%
print
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df_list[[i]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
imap(df_list, cut.colname.BL)
imap(df_list, cut.colname.BL)
i
df_list <- list()
df_list[[1]] <- df %>%
select(matches("[a-z][0-9]{1}$|grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5"),
-durs1)
df_list[[2]] <- df %>%
select(matches("[a-z][0-9]{2}$|gdpsh5|gdpsh4|pop15|pop65|lifee0|pysh5|pcsh5|pish5|pgsh5"),
-c(matches("grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5|smpl97")
))
df_list[[3]] <- df %>%
select(matches("bmp[0-9]l|bmp2ml"))
df_list[[4]] <- df %>%
select(names(df)[which(!names(df) %in% c(names(dfy), names(dfyy), names(dfyl)))])
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
} else if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
} else if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %>%
return()
}
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
print(i)
if(i == 3) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = "bmpl",
Type = "x") %>%
return()
} else {if(i == 4) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %>%
return()
}
map(cut_colname_file %>% pull(Colname), melt.BL, df)
melt.BL <- function(cn, df) {
df %>%
select(matches(paste0("^", cn, "[0-9]{2}$")), WBCTRY) %>%
as.data.table() %>%
melt.data.table(id.vars = "WBCTRY",
variable.name = "Indicator",
value.name = "Value") %T>%
mutate(Year = paste0("19",
substring(Indicator,
nchar(Indicator)-1)),
Indicator = substr(Indicator, 1, nchar(Indicator)-2))
}
# train <- df_colnames %>% sample_n(3)
#
read.table(paste0("data/barrolee/","codes.prn"))
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 3) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = "bmpl",
Type = "x") %>%
return()
} else {if(i == 4) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %>%
return()
}
}
imap(df_list, cut.colname.BL)
imap_dfr(df_list, cut.colname.BL)
cut_colnames_type <- imap_dfr(df_list, cut.colname.BL)
cut_colname_file %>% pull(Colname_cut) %>% unique
cut_colname_type %>% pull(Colname_cut) %>% unique
cut_colname_type <- imap_dfr(df_list, cut.colname.BL)
cut_colname_type %>% pull(Colname_cut) %>% unique
library(wbstats)
library(dplyr)
library(data.table)
library(rio)
library(stringr)
library(magrittr)
library(purrr)
wbstats::wbcountries()
wbstats::wbcountries() %>% head
wbstats::wbindicators()
wbstats::wbindicators() %>% head()
wbsources()
wbsources() %>% head
wbsources()[,3]
wbsources()[44,]
wbstats::wbsearch("GDP")
wbstats::wbsearch("GDP per capita")
wb(indicator = c("7989","7990"), startdate = 2010, enddate = 2017, freq = "Y")
wb(indicator = "7989", startdate = 2010, enddate = 2017, freq = "Y")
wb(indicator = 7989, startdate = 2010, enddate = 2017, freq = "Y")
c("NY.GDP.PCAP.KD.ZG","NY.GDP.PCAP.KD")
wb(indicator = c("NY.GDP.PCAP.KD.ZG","NY.GDP.PCAP.KD"), startdate = 2010, enddate = 2017, freq = "Y")
data1 <- wb(indicator = c("NY.GDP.PCAP.KD.ZG","NY.GDP.PCAP.KD"),
startdate = 2010,
enddate = 2017,
freq = "Y")
names(data1)
data1.1 <- data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID)
names(data1.1)
data1.1
data1
data1.1 <- data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3, country) %>%
sort(date) %>%
head
data1.1 <- data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
sort(date) %>%
head
data1.1 <- data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
head
data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
head
data1.1 <- data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
summarise(growth = prod(NY.GDP.PCAP.KD.ZG/100+1)^(1/8),
gdp = gdp[1])
data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
summarise(growth = prod(NY.GDP.PCAP.KD.ZG/100+1)^(1/8),
gdp = NY.GDP.PCAP.KD[1])
data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
head
data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
summarise(growth = prod(NY.GDP.PCAP.KD.ZG/100+1)^(1/8),
gdp = NY.GDP.PCAP.KD[1])
lm(formula = growth~gdp, data = data1.1)
data1.1 <- data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
summarise(growth = prod(NY.GDP.PCAP.KD.ZG/100+1)^(1/8),
gdp = NY.GDP.PCAP.KD[1])
lm(formula = growth~gdp, data = data1.1)
data1.1 %>% qplot
library(ggplot2)
data1.1 %>% qplot
data1.1 %>% qplot(gdp, growth)
data1.1 <- data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
summarise(growth = prod(NY.GDP.PCAP.KD.ZG/100+1)^(1/8),
gdp = NY.GDP.PCAP.KD[1])
qplot(gdp, growth, data = data1.1)
data1.1 <- data1 %>%
select("iso3c", "country", "indicatorID", "date", "value") %>%
as.data.table() %>%
dcast.data.table(iso3c + country + date~ indicatorID) %>%
group_by(iso3c, country) %>%
arrange(date) %>%
summarise(growth = prod(NY.GDP.PCAP.KD.ZG/100+1)^(1/8) - 1,
gdp = NY.GDP.PCAP.KD[1])
qplot(gdp, growth, data = data1.1)
wbindicators() %>% head
