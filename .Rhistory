select(matches("50$|55$|60$|65$|70$|75$|80$|85$|90$"),
-starts_with(c("GDPSH5",  "GDP5")))
df %>%
select(matches("50$|55$|60$|65$|70$|75$|80$|85$|90$"),
-c(starts_with("GDPSH5"),starts_with("GDP5")))
dfyyL <- df %>%
select(matches("[0-9]{2}L$")
dfyy <- df %>%
select(matches("50$|55$|60$|65$|70$|75$|80$|85$|90$"),
-c(starts_with("GDPSH5"),
starts_with("GDP5"),
starts_with("GRSH5"),
starts_with("INVSH5")))
# с одной цифрой или просто плохие
# INVWBx GRWBx INVSH5x GRSH5x GDPSH5xx
# INVSH4x GRSH4x GDPSH4xx
# SMPL97 DURS1 POP15xx
# POP65xx GOVSH4x GOVSH5x GDEx GEERECx GEETOTx
# INVPUBx GGCFDx GVXDXE4x GVXDXE5x PINSTABx ASSASSPx
# COUPx REVOLx PINSTABx POLRIGHTx CIVLIBx EXx
# IMx BMPx TOTx LLYx
dfy <- df %>%
select(matches("1$|1$|3$|4$|5$|75$|80$|85$|90$"))
cut_colname_file <- data.frame(Colname = colnames(dfyy)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-2)) %>%
unique()
map(cut_colname_file %>% pull(Colname), melt.BL, df)
melt.BL <- function(cn, df) {
df %>%
select(matches(paste0("^", cn, "[0-9]{2}$")), WBCTRY) %>%
as.data.table() %>%
melt.data.table(id.vars = "WBCTRY",
variable.name = "Indicator",
value.name = "Value") %T>%
mutate(Year = paste0("19",
substring(Indicator,
nchar(Indicator)-1)),
Indicator = substr(Indicator, 1, nchar(Indicator)-2))
}
# train <- df_colnames %>% sample_n(3)
#
read.table(paste0("data/barrolee/","codes.prn"))
dfyyL <- df %>%
select(matches("[0-9]{2}L$"))
ddyyL
dfyyL
df
dfyyl <- df %>%
select(matches("[0-9]{2}l$"))
ddyyl
dfyyl
df %>%
select(matches("[0-9]{2}l$"))
df %>%
select(matches("[0-9]{2}$"))
ddy <- df %>%
selet(matches("[:letters:][:digits:]$"),
-durs1)
ddy <- df %>%
select(matches("[:letters:][:digits:]$"),
-durs1)
dfy <- df %>%
select(matches("[:letters:][:digits:]$"),
-durs1)
rm(ddy)
dfy
dfy %>% hed
dfy %>% head
dfy <- df %>%
select(matches("[:letters:]{1}[:digits:]{1}$"),
-durs1)
dfy
dfy %>% head
dfy <- df %>%
select(matches("[:digits:]{1}$"),
-durs1)
dfy %>% head()
df
dfy %>% head()
dfy <- df %>%
select(matches("[0-9]{1}$"),
-durs1)
dfy
dfy <- df %>%
select(matches("[a-z][0-9]{1}$"),
-durs1)
dfy
dfy %>% head
dfy %>% names()
dfyy <- df %>%
select(matches("[a-z][0-9]{2}$"),
-c(matches("GDPSH5|GRSH5|INVSH5|INVSH4|
GRSH4|SMPL97|GOVSH4|GOVSH5|GVXDXE4|GVXDXE5")
))
dfyy
dfyy %>% names()
dfy %>% names()
dfyy %>% names()
dfy %>% names()
dfy <- df %>%
select(matches("[a-z][0-9]{1}$|GRSH5|INVSH5|INVSH4|
GRSH4|GOVSH4|GOVSH5|GVXDXE4|GVXDXE5"),
-durs1)
dfy %>% names()
dfyy <- df %>%
select(matches("[a-z][0-9]{2}$|GDPSH5|GDPSH4|POP65"),
-c(matches("GRSH5|INVSH5|INVSH4|
GRSH4|GOVSH4|GOVSH5|GVXDXE4|GVXDXE5|SMPL97")
))
dfyy %>% names()
153+337
df %>% select(!names(dfy))
df %>% select(-names(dfy))
names(dfy)
df %>% select(-names(dfy))
df %>% select(-c(names(dfy)))
df %>% select(-c(coup1, coup2))
names(dfy)
df %>% select(-c(names(dfy)))
df %>% select(-matches(names(dfy)))
df %>% select(c(names(dfy)))
df %>% select(names(dfy))
names(df)[which(!names(df) %in% c(names(dfy), names(dfyy)))]
181+390+65
dfyy <- df %>%
select(matches("[a-z][0-9]{2}$|gdpsh5|gdpsh4|pop15|pop65|lifee0|pysh5|pcsh5|pish5|pgsh5"),
-c(matches("grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5|smpl97")
))
153+373+65
dfy <- df %>%
select(matches("[a-z][0-9]{1}$|grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5"),
-durs1)
names(df)[which(!names(df) %in% c(names(dfy), names(dfyy)))]
153+373+29
dfyl <- df %>% select(matches("bmp"))
dfyl
dfyl %>% names
dfyl <- df %>%
select(matches("bmp[0-9]l|bmp2ml"))
dfyl %>% names
names(df)[which(!names(df) %in% c(names(dfy), names(dfyy), names(dfyl)))]
dfconst <- df %>%
select(names(df)[which(!names(df) %in% c(names(dfy), names(dfyy), names(dfyl)))])
23+153+6+373
cut_colname_file <- data.frame(Colname = colnames(dfyy)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-2)) %>%
unique()
cut_colname_file
df_list <- list()
df_list <- list()
df_list$dfy <- df %>%
select(matches("[a-z][0-9]{1}$|grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5"),
-durs1)
df_list$dfyy <- df %>%
select(matches("[a-z][0-9]{2}$|gdpsh5|gdpsh4|pop15|pop65|lifee0|pysh5|pcsh5|pish5|pgsh5"),
-c(matches("grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5|smpl97")
))
df_list$dfyl <- df %>%
select(matches("bmp[0-9]l|bmp2ml"))
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = if_else(i == 2, "xx",
if_else(i == 1, "x", "con"))) %>%
unique() %>%
return()
}
imap(df_list, cut.colname.BL)
df_list[[1]]
df_list[[1]] %>% colnames()
df_list[[2]] %>% colnames()
file_colname
data.frame(Colname = colnames(df_list[[1]])) %>%
inner_join(file_colname, by = "Colname")
data.frame(Colname = colnames(df_list[[1]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-1))
i=1
data.frame(Colname = colnames(df_list[[i]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con")))
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %T>%
print() %>%
return()
}
imap(df_list, cut.colname.BL)
df_list
cut.colname.BL <- function(df, i) {
print(df)
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %T>%
print() %>%
return()
}
imap(df_list, cut.colname.BL)
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %T>%
print() %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %T>%
print() %>%
return()
}
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
imap(df_list, cut.colname.BL)
i=1
data.frame(Colname = colnames(df[[i]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i))
i=1
data.frame(Colname = colnames(df[[i]]))
df[[1]]
i=1
data.frame(Colname = colnames(df_list[[i]])) %>%
inner_join(file_colname, by = "Colname")
i=1
data.frame(Colname = colnames(df_list[[i]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i))
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df_list[[i]])) %>%
print
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df_list[[i]])) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
}
if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
imap(df_list, cut.colname.BL)
imap(df_list, cut.colname.BL)
i
df_list <- list()
df_list[[1]] <- df %>%
select(matches("[a-z][0-9]{1}$|grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5"),
-durs1)
df_list[[2]] <- df %>%
select(matches("[a-z][0-9]{2}$|gdpsh5|gdpsh4|pop15|pop65|lifee0|pysh5|pcsh5|pish5|pgsh5"),
-c(matches("grsh5|invsh5|invsh4|
grsh4|govsh4|govsh5|gvxdxe4|gvxdxe5|smpl97")
))
df_list[[3]] <- df %>%
select(matches("bmp[0-9]l|bmp2ml"))
df_list[[4]] <- df %>%
select(names(df)[which(!names(df) %in% c(names(dfy), names(dfyy), names(dfyl)))])
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
} else if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i)) %>%
print
#        Type = ifelse(i == 2, "xx",
#                       ifelse(i == 1,
#                               "x",
#                               "con"))) %>%
# unique() %T>%
# print() %>%
# return()
}
cut.colname.BL <- function(df, i) {
if(i == 4) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname = "bmpl",
Type = "x") %>%
return()
} else if(i == 3) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %>%
return()
}
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
print(i)
if(i == 3) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = "bmpl",
Type = "x") %>%
return()
} else {if(i == 4) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %>%
return()
}
map(cut_colname_file %>% pull(Colname), melt.BL, df)
melt.BL <- function(cn, df) {
df %>%
select(matches(paste0("^", cn, "[0-9]{2}$")), WBCTRY) %>%
as.data.table() %>%
melt.data.table(id.vars = "WBCTRY",
variable.name = "Indicator",
value.name = "Value") %T>%
mutate(Year = paste0("19",
substring(Indicator,
nchar(Indicator)-1)),
Indicator = substr(Indicator, 1, nchar(Indicator)-2))
}
# train <- df_colnames %>% sample_n(3)
#
read.table(paste0("data/barrolee/","codes.prn"))
imap(df_list, cut.colname.BL)
cut.colname.BL <- function(df, i) {
if(i == 3) {
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = "bmpl",
Type = "x") %>%
return()
} else {if(i == 4) {
i <- 0
}
data.frame(Colname = colnames(df)) %>%
inner_join(file_colname, by = "Colname") %>%
mutate(Colname_cut = substr(Colname, 1,nchar(Colname)-i),
Type = ifelse(i == 2, "xx",
ifelse(i == 1,
"x",
"con"))) %>%
unique() %>%
return()
}
}
imap(df_list, cut.colname.BL)
imap_dfr(df_list, cut.colname.BL)
cut_colnames_type <- imap_dfr(df_list, cut.colname.BL)
cut_colname_file %>% pull(Colname_cut) %>% unique
cut_colname_type %>% pull(Colname_cut) %>% unique
cut_colname_type <- imap_dfr(df_list, cut.colname.BL)
cut_colname_type %>% pull(Colname_cut) %>% unique
